# 插件使用指南

> ⚠️ **核心原则**：遇到问题先考虑插件已有功能，权衡利弊后再给出方案！

---

## 一、GAS Companion

### 插件用途
为 Gameplay Ability System 提供蓝图友好的基类和组件，省去大量 C++ 样板代码。

### 核心功能

| 功能 | 说明 |
|:-----|:-----|
| **模块化基类** | GSCModularPlayerState / PlayerController / Character / Pawn / Actor |
| **ASC 自动创建** | 基类自带 GSCAbilitySystemComponent |
| **配置式授予** | 通过 Details 面板直接配置 Grant Abilities / Attributes / Effects |
| **输入绑定** | GSCAbilityInputBindingComponent 支持 Enhanced Input 绑定 GA |
| **连招系统** | GSCComboManagerComponent + GSCComboWindowNotifyState |
| **技能队列** | GSCAbilityQueueComponent 实现技能排队 |
| **UI 支持** | GSCUserWidget / GSCUWHud 提供属性绑定 |

### 项目需求映射

| 项目需求 | 推荐使用 | 替代原生实现 |
|:---------|:---------|:-------------|
| PlayerState 需要 ASC | `GSCModularPlayerState` | 手动创建 ASC + 配置 Owner/Avatar |
| 角色需要使用能力系统 | `GSCModularCharacter` | 手动初始化 ASC 连接 |
| 技能绑定输入 | `GSCAbilityInputBindingComponent` | 手动绑定 IA 到 TryActivateAbility |
| 属性初始化 | Grant Attributes + DataTable | 手动在 BeginPlay 中初始化 |
| 推搡等技能 | `GSCGameplayAbility` 子类 | 普通 GA |
| HUD 显示属性 | `GSCUWHud` | 手动监听 Attribute 变化 |

### 官方文档
https://gascompanion.github.io/

---

## 二、Blueprint Attributes

### 插件用途
让属性集（AttributeSet）完全可以在蓝图中定义，无需 C++。

### 核心功能

| 功能 | 说明 |
|:-----|:-----|
| **蓝图属性集** | 直接在蓝图编辑器中定义 Gameplay Attributes |
| **GE 完美集成** | 与 Gameplay Effects 无缝配合 |
| **内置 Clamping** | 支持 Min/Max 限制 |
| **MMC/Exec 支持** | 蓝图中实现 Magnitude Modifier / Execution Calc |
| **复制支持** | 完整的多人复制功能 |
| **Save/Load** | 属性持久化支持 |
| **重构支持** | 重命名属性自动更新引用 |

### 项目需求映射

| 项目需求 | 推荐使用 | 替代原生实现 |
|:---------|:---------|:-------------|
| 属性定义与同步 | 必须点击工具栏的 **"Add Attribute"** 按钮，在弹出的表单中定义变量名。勾选 Replication 会自动生成 `OnRep_XXX` 函数并处理底层同步。 | 手写 C++ 属性宏 |
| 值初始化与 Clamping | 点击 **"Create DataTable"** 后，在表格的 `Min Value` 和 `Max Value` 列设置限制。基类会自动读取表格实现数值截断。 | C++ 代码限制 |
| 属性变化回调 | 直接 Override `PostGEExecute` (逻辑触发) 或 `PostAttrChange` (UI同步) | C++ 虚函数重写 |
| 联机支持 | 蓝图中重写的 `OnRep_XXX` 已预设好代码块（类似 C++ 的宏逻辑），支持客户端预测。 | 繁琐的 C++ 样板代码 |

### 核心操作流程 (官方规范)
1. **创建蓝图**：在文件夹右键 `Gameplay -> Gameplay Blueprint Attribute Set`。
2. **添加属性 (关键)**：点击编辑器顶部工具栏的 **"Add Attribute"**。
    - 在表单中输入 `Name`。
    - 勾选 `Replication` (这会自动创建同步函数，千万不要手动删掉)。
    - 完成后，属性会以特殊的图标出现在变量栏。
3. **生成 & 配置数据表**：
    - 点击左上角的 **"Create DataTable"**。
    - 打开生成的 DataTable，在每一行（对应一个属性）中：
        - `Base Value`: 设定初始值。
        - `Min Value`: 设定最小值（如血量设为 0）。
        - `Max Value`: 设定最大值（如血量设为 100；不需要上限的属性如金币，可设为极大数据或不启用限制）。
4. **组件绑定**：在 `PlayerState` 的 `GSCAbilitySystemComponent` 中的 **"Default Starting Data"** 数组里，填入该 Attribute Set 蓝图及其对应的 DataTable。

### 关于 "属性测试" 的翻译
这是 GAS Companion 中文本地化的机翻结果，原词应为 **"Attribute Sets"** 或 **"Attributes"**。在插件源码中该分类被划分为开发测试类，因此被误译为“属性测试”，请放心在其中配置 `Default Starting Data`。

### 官方文档
https://blueprintattributes.github.io/docs/ (注：该插件与 GAS Companion 同属一个开发者，两者配合极佳)

---

## 三、State Tree (UE5 内置)

### 功能用途
UE5 内置的分层状态机系统，结合了状态机和行为树的优点，适用于关卡流程、AI 行为、交互物体等。

### 启用方式
Project Settings → Plugins → 启用 **State Tree** + **Gameplay State Tree**

### 核心功能

| 功能 | 说明 |
|:-----|:-----|
| **State Tree 资产** | 可视化设计状态和转换 |
| **StateTreeComponent** | Actor 组件，驱动状态树运行 |
| **States** | 状态节点，可嵌套子状态 |
| **Tasks** | 状态内执行的任务 |
| **Transitions** | 状态间转换条件 |
| **Evaluators** | 数据收集器，可在 Tick 时运行 |

### 项目需求映射

| 项目需求 | 推荐使用 | 替代原生实现 |
|:---------|:---------|:-------------|
| 关卡流程 (Preparing→InProgress→Settlement) | GS 上添加 StateTreeComponent | 手写状态枚举 + Switch |
| 交互物体状态 (门/答题台) | Actor 上添加 StateTreeComponent | 手写状态逻辑 |
| 木偶行为 (红绿灯切换) | State Tree | 蓝图 Tick + 状态变量 |
| AI 行为 | State Tree | UE 原生 Behavior Tree |

### 核心操作流程
1.  **创建资产**：Content Browser 右键 → **Artificial Intelligence → StateTree**。
2.  **选择 Schema**：
    *   **通用逻辑**：选择 `StateTreeComponentSchema` (**重要：不要选 AIComponentSchema，那是给 AI 用的**)
    *   **AI 行为**：选择 `StateTreeAIComponentSchema`
3.  **设计状态**：拖入 State 节点，配置进入/退出逻辑。
4.  **添加 Task**：在状态内添加 Task 执行具体行为。
5.  **配置 Transition**：设置转换条件（Tick、事件触发等）。
6.  **挂载组件**：给 Actor 添加 `StateTreeComponent`，配置 `State Tree` 资产。

### 官方文档
https://dev.epicgames.com/documentation/en-us/unreal-engine/state-tree-overview-in-unreal-engine

---

## 四、Advanced Sessions

### 插件用途
增强 UE 原生 Session 系统，提供更多蓝图节点，支持 Steam 集成。

### 核心功能

| 功能 | 说明 |
|:-----|:-----|
| **AdvancedFriendsGameInstance** | GameInstance 基类，内置好友和会话功能 |
| **Create Advanced Session** | 创建带自定义参数的 Session |
| **Find Advanced Sessions** | 搜索并过滤 Session |
| **Steam 集成** | AdvancedSteamSessions 模块 |
| **邀请系统** | OnSessionInviteReceived / AcceptedSessionInvite |
| **语音支持** | 网络语音控制 |

### 项目需求映射

| 项目需求 | 推荐使用 | 替代原生实现 |
|:---------|:---------|:-------------|
| GameInstance 基类 | `AdvancedFriendsGameInstance` | 原生 UGameInstance |
| 创建房间 | Create Advanced Session | Create Session |
| 搜索房间 | Find Advanced Sessions | Find Sessions |
| 加入房间 | Join Session | 原生 Join |
| Steam 联机 | AdvancedSteamSessions | 手动配置 Steam Subsystem |

### 官方文档
https://vreue4.com/generated-node-documentation?section=advanced-sessions-plugin

---

## 五、项目需求与插件对应表

| 项目模块 | 主要插件 | 具体功能 |
|:---------|:---------|:---------|
| **核心框架** | GAS Companion | GSCModular* 基类 |
| **属性系统** | Blueprint Attributes | BAS_Core (Health/Coins) |
| **关卡流程** | State Tree | ST_LevelFlow |
| **会话管理** | Advanced Sessions | AdvancedFriendsGameInstance |
| **技能系统** | GAS Companion | GA_Shove / GA_Dodge |
| **状态效果** | GAS Companion | GE_Stun / GE_Balance |
| **木偶行为** | State Tree | ST_Puppet |
| **交互物体** | State Tree | Actor + StateTreeComponent |
| **匹配系统** | Advanced Sessions | Create/Find/Join Advanced Session |

---

## 更新日志

| 日期 | 内容 |
|:-----|:-----|
| 2024-12-25 | 创建插件使用指南 |
