# 整体流程

## 关卡结构

```
L_MainMenu (主菜单 + 匹配菜单，同一关卡不同UI)
    ↓ 加入房间
L_Lobby (等待大厅)
    ↓ ServerTravel
L_Endurance → L_Logic → L_Courage → L_Insight → L_Sacrifice
```

## 主菜单 (L_MainMenu)

- 主菜单页：开始游戏 / 设置 / 退出
- 匹配菜单页：头像显示、房间列表、创建/搜索/随机、修改Avatar

## 等待大厅 (L_Lobby)

**开始条件**（满足任一）：
- 倒计时结束（默认30s）
- 人数满
- 人数 ≥ 阈值 + 全员同意 → 倒计时缩短为5s

**开始时**：AI 填充空位

## 游戏关卡 (L_Endurance ~ L_Sacrifice)

- **中途禁止加入**：游戏开始后不允许新玩家进入
- **真人全死 → 游戏结束**：只剩 AI 时直接结束整局
- **违规即死**：不遵守规则直接死亡（类似鱿鱼游戏"从天而降的激光"风格）
- 每关流程：开场动画 → 游戏进行 → 结算画面（淘汰者变灰）

## 编号系统

| 时机 | 处理 |
|:-----|:-----|
| 玩家进入等待大厅 | 分配编号，全程不变 |
| AI 填充 | 分配编号，全程不变 |
| 玩家掉线 | AI 接管，继承原编号 |

## 淘汰与掉线

| 情况 | 处理 |
|:-----|:-----|
| 玩家死亡 | 返回主菜单，服务器端记录标记为淘汰 (bEliminated) |
| 玩家掉线 | AI 接管该编号位 |

## 金币系统

- 玩家进入游戏时有初始金币
- 死亡掉落全部金币（所有关卡通用）
- 使用属性集(AttributeSet)实现

| 关卡 | 金币用途 |
|:-----|:---------|
| 关卡1 | 无 |
| 关卡2 | 购买提示 |
| 关卡3 | 购买线索 |
| 关卡4 | 无 |
| 关卡5 | 扔硬币测试玻璃 |

## HP系统

- 初始100HP，使用属性集(AttributeSet)实现
- 每关开始时恢复满
- HP归零 → 死亡

| 关卡 | HP机制 |
|:-----|:-------|
| 关卡1 | 违规即死（不扣HP） |
| 关卡2 | 房间惩罚扣HP |
| 关卡3 | 毒气判定即死（不扣HP） |
| 关卡4 | 答错扣HP |
| 关卡5 | 踩错/QTE失败即死（不扣HP） |

## 玩家记录 (跨关卡)

维护数组 `PlayerRecords[]`，记录所有玩家：
- PlayerNum、AvatarData、bEliminated
- 淘汰打标记，不删除（用于结算显示）

## 形象系统

- 材质参数实现
- 编号 + 头像显示在角色身上
- 数据存储在 PlayerState，同步给所有客户端

## 待定系统

- 荣誉值系统（后期）
