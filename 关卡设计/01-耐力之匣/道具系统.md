# 道具系统

> 关卡1（耐力之匣）道具系统设计概述

---

## 持有规则

| 类型 | 规则 |
|------|------|
| **投掷类** | 最多 **1 个**，后捡覆盖 |
| **Buff 类** | 可同时 **多种**，同种重复 **重置时间** |
| **资源类** | 拾取即生效 |

---

## 道具总览

| 类型 | 道具 | 效果 | 模型 | 实现状态 |
|------|------|------|------|:--------:|
| 投掷 | Banana | 命中失衡，落地变陷阱 | Show + Prop | ❌ |
| 投掷 | Bomb | 范围摔倒 | Show + Prop | ❌ |
| Buff | Lightning | SpeedRate ×1.5 | 仅 Show | ❌ |
| Buff | Shield | 抵消攻击 / 检测伤害减半 | 仅 Show | ❌ |
| Buff | MedicalKit | HP +50 | 仅 Show | ❌ |
| 资源 | Coin | 积分 +1 | 仅 Show | ❌ |

---

## 数据结构

### S_ItemData

**路径**：`Content/0_/Blueprints/Structs/S_ItemData`

| 字段 | 类型 | 说明 |
|------|------|------|
| Name | Text | 道具名称 |
| Icon | Texture2D | UI 图标 |
| ShowMesh | Static Mesh | 场地展示模型 |
| PropMesh | Static Mesh | 手持模型（Buff/Resource 为 None） |
| ItemType | EItemType | 逻辑类型 |
| LaunchForce | Float | 投掷力度 |
| ItemAbility | GA Class | 拾取时触发的 GA |

### DT_ItemData

**路径**：`Content/0_/DataTables/DT_ItemData`

| RowName | Type | LaunchForce | ItemAbility |
|---------|------|-------------|-------------|
| Banana | Throwable | 1500 | None |
| Bomb | Throwable | 1200 | None |
| Lightning | Buff | - | GA_Item_Lightning |
| Shield | Buff | - | GA_Item_Shield |
| MedicalKit | Buff | - | GA_Item_MedicalKit |
| Coin | Resource | - | GA_Item_Coin |

> **当前进度**：Mesh 数据已填充，Icon 和 ItemAbility 待后续补充

---

## 通用接口

| 接口 | 位置 | 说明 | 状态 |
|------|------|------|:----:|
| `OnPickup(Character)` | BP_Item_Base | 拾取道具 | ✅ |
| `OnTrap(Character)` | BP_Item_Base | 陷阱触发（子类重写） | ✅ |
| `GetThrowItemID()` | Comp_Character_Endurance | 获取持有道具 ID | ✅ |
| `SetThrowItemID(ItemID)` | Comp_Character_Endurance | 设置持有道具 ID | ✅ |
| `ClearThrowItemID()` | Comp_Character_Endurance | 清除持有道具 | ✅ |

---

## 护盾机制 (Shield)

**GE_Buff_Shield**：添加 `Player.State.Shielded`，Duration 30s

| 场景 | 行为 | 实现状态 |
|------|------|:--------:|
| 被推搡 | 抵消，消耗护盾 | ❌ |
| 被炸弹 | 抵消，消耗护盾 | ❌ |
| 被检测 | 伤害减半，消耗护盾 | ❌ |
| 受惊吓 | 抵消，消耗护盾 | ❌ |

---

## Buff 效果

| 道具 | GE | 效果 | 实现状态 |
|------|-----|------|:--------:|
| Lightning | GE_Buff_Lightning | SpeedRate ×1.5 | ❌ |
| Shield | GE_Buff_Shield | Shielded 标签 | ❌ |
| MedicalKit | GE_Buff_MedicalKit | HP +50 | ❌ |

---

## UI 预留

| 元素 | 事件源 | 实现状态 |
|------|--------|:--------:|
| 道具栏 | `Comp_Character_Endurance.OnThrowItemChanged` | ❌ |
| Buff 倒计时 | `OnGameplayEffectTimeChange` | ❌ |
| 准星 | GA_Aim | ❌ |

---

## Gameplay Cue 预留 (Phase 9)

| Cue Tag | 特效 | 状态 |
|---------|------|:----:|
| `GameplayCue.Buff.Lightning` | 加速拖尾 | ❌ |
| `GameplayCue.Buff.Shield` | 护盾光环 | ❌ |
| `GameplayCue.Item.Bomb.Explode` | 爆炸 VFX/SFX | ❌ |

---

## 相关文档

- [BP_Item_Base.md](核心类/BP_Item_Base.md) - 道具基类实现
- [瞄准投掷系统.md](GAS/瞄准投掷系统.md) - GA_Aim / GA_Throw 实现
- [DA_ItemSystemConfig.md](GAS/DA_ItemSystemConfig.md) - 数据资产配置
- [Comp_Character_Endurance.md](核心类/Comp_Character_Endurance.md) - 道具接口实现
