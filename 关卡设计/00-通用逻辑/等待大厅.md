# 等待大厅设计（待实现）

等待大厅是玩家进入联机的第一步，独立于正式关卡。

---

## 一、核心职责

- 收集真人玩家，建立初始 PlayerRecords
- **不填充 AI**：只确认真人数量
- 为这局游戏（Dedicated Server）确定参赛者名单

---

## 二、开始条件

满足以下任一条件即可进入第一关：

| 条件 | 说明 |
|------|------|
| 倒计时结束 | 等待时间到期，无论人数多少 |
| 人数达到上限 | 如 15 人满员，立即开始 |
| 人数过半 + 全员同意 | 如 8 人以上，且所有人点击"准备" |

---

## 三、架构设计

### 独立的 GM/GS

| 类名 | 职责 |
|------|------|
| GM_Lobby | 处理玩家登录、开始条件判断、触发无缝切换 |
| GS_Lobby | 存储等待状态、倒计时、玩家准备状态 |

### PlayerRecords 存储位置

> PlayerRecords 存储在 `GI_FiveBox`（GameInstance），详见 [系统架构.md](系统架构.md#三数据结构)。

---

## 四、数据流向

```
玩家连接等待大厅
    ↓
GM_Lobby.OnPostLogin
    ↓
GI_FiveBox.GetUniquePlayerNum → 分配编号
    ↓
RandomAvatar → 生成外观（或玩家自定义）
    ↓
GI_FiveBox.PlayerRecords ← 添加记录 (IsHuman: true)
    ↓
满足开始条件
    ↓
ServerTravel 到第一关
    ↓
第一关 FillAI → 补齐 AI → PlayerRecords 数量固定
```

---

## 五、与正式关卡的区别

| 特性 | 等待大厅 | 正式关卡 |
|------|----------|----------|
| FillAI | ❌ 不执行 | ✅ 执行（第一关补齐，后续不触发） |
| RestoreAISurvivors | ❌ 不执行 | ✅ 执行 |
| PlayerRecords 来源 | 玩家登录时创建 | 从 GI_FiveBox 读取 |
| 状态树 | 可能不同（等待逻辑） | ST_LevelFlow_Main |

---

## 六、待确定事项

- [ ] 玩家是否可以在等待大厅自定义外观？
- [ ] 等待大厅的最大等待时间？
- [ ] 人数不足时的处理（取消匹配 or 强制开始）？
- [ ] 等待大厅的视觉表现（场景、UI）？
