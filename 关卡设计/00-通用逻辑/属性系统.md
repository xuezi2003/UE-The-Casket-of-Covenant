# 属性系统

## 一、BAS_Core 属性集

使用 **Blueprint Attributes** 插件创建的蓝图 AttributeSet（`BAS_Core`）。

> [!NOTE]
> 项目保持 **C++ 与蓝图混合架构**，便于后期扩展（原 C++ 实现的 `AS_Core` 已删除）。

### 属性列表

| 属性 | 基础值 | 最小值 | 最大值 | 说明 |
|------|--------|--------|--------|------|
| Coin | 0 | 0 | 无限制 | 金币（跨关卡） |
| Health | 100 | 0 | MaxHealth | 生命值 |
| MaxHealth | 100 | - | - | 最大生命值 |
| Stamina | 100 | 0 | MaxStamina | 体力 |
| MaxStamina | 100 | - | - | 最大体力 |
| SpeedRate | 1.0 | - | - | 速度倍率 |
| BaseSpeed | 350 | - | - | 基础速度 |

### 属性用途

- **Coin**：金币积分，跨关卡保留
- **Health**：生命值，归零即淘汰（⏳ Phase 6：Comp_Character_Endurance 监听处理）
- **Stamina**：体力，用于奔跑等消耗（关卡1、5）
- **SpeedRate**：速度倍率，奔跑/蹲行时修改此值
- **BaseSpeed**：基础移动速度

---

## 二、速度计算

```
最大行走速度 = BaseSpeed × SpeedRate
```

采用 **双重保险方案** 确保多端同步：

1. **BAS_Core**：重写 `PostAttributeChange` 事件（覆盖 Server/Simulated）
2. **BP_Character_Game**：监听 `OnAttributeChange` 委托（补充本地预测）

```
Event PostAttributeChange (BAS_Core)
    ↓
HandleSpeedRateChanged

On Attribute Change (BP_Character_Game)
    ↓
HandleSpeedRateChanged
```

> [!NOTE]
> 这种组合方式既利用了 GAS 的底层复制通知，又通过本地委托处理了即时预测，确保在所有网络端和边缘情况下速度都能正确刷新。

---

## 三、属性持久化

| 属性 | 跨关卡持久化 | 持久化方式 |
|------|--------------|------------|
| **Coin** | ✅ 是 | `GI_FiveBox.PlayerRecords`（Phase 2 实现） |
| HP/Stamina/Speed | ❌ 每关重置 | 无需持久化 |

### PC/PS 生命周期

| 对象 | 无缝切换时的行为 | 数据持久化建议 |
|------|------------------|---------------|
| **PlayerController** | **重新创建** | 不存储持久数据 |
| **PlayerState** | 重新创建，`CopyProperties` 自动复制 | ✅ 存储玩家身份数据 |
| **GameInstance** | 存活至游戏关闭 | ✅ 存储跨关卡全局数据 |

---

## 四、GSCCore 配置

| 设置 | 值 | 说明 |
|------|-----|------|
| 组件复制 | ✅ | ASC 需要复制属性到客户端 |
| 启用 Tick | ✅ | 可选，不需要可关闭 |
| 自动启用 | ❌ | 由系统自动管理 |

---

## 相关文档

- [UI 架构概述](UI/架构概述.md)
- [输入系统.md](输入系统.md)
- [系统架构.md](系统架构.md)
- [Plugin Documentation Links.md](../../参考文档/Plugin%20Documentation%20Links.md)（Blueprint Attributes）
