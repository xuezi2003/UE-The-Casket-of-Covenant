# 2026-01-26 待办（已归档）

> [!NOTE]
> 本日完成了 Phase 7.10（测试阶段控制功能）和 Phase 7.6 部分测试（6/13 详细行为测试 + 2/4 档案管理测试）。修复了 2 个关键 Bug（Service 更新问题、WeightedRandomSelector 首次执行问题）。未完成任务已迁移至 [2026-01-27.md](2026-01-27.md)。

---

## 当日完成

### Phase 7.10: 测试阶段控制功能 ✅
- [x] Preparing 阶段测试（隐式通过）
- [x] InProgress 阶段测试
- [x] 验证 AI 只在 InProgress 阶段才执行逻辑

### Phase 7.6: 详细行为测试 ✅（6/13）
- [x] 测试用例 1：走出起点线
- [x] 测试用例 2：红灯原地不动
- [x] 测试用例 3：红灯偷偷动
- [x] 测试用例 4：绿灯向前移动
- [x] 测试用例 11：玩家完成的档案管理
- [x] 测试用例 12：关卡提前结束判定

### Bug 修复 ✅
- **问题 1**：断开分支测试时，Service 无法更新导致行为树卡死
  - 解决：在根 Selector 末尾添加兜底 Wait Task (0.5s)
- **问题 2**：BTService_WeightedRandomSelector 第一次必然执行 Index 0
  - 解决：改用 ReceiveSearchStartAI + 改判断条件为 `Sum > RandomValue`

---

## 后续 Phase 优先级

| 优先级 | Phase | 内容 |
|:------:|-------|------|
| 1 | Phase 7.6 详细行为测试 | 剩余 7 个测试用例（推搡、闪避、战斗优先级、死亡中断、网络延迟） |
| 2 | Phase 7.6 档案管理测试 | 剩余 2 个测试用例（玩家淘汰、所有玩家死亡） |
| 3 | Phase 7.6 最终验收 | 恢复配置，验证整体随机性 |
| 4 | Phase 8 | UI 完善 |
| 5 | Phase 9 | 特效/音效 |

---

## 备注

**测试工具**：
- Gameplay Debugger（`'` 键）：查看行为树状态、Blackboard 键值
- slomo 命令：调整游戏速度（0.5 慢速，2.0 快速，1.0 正常）

**测试技巧**：
- **断开连线**：在行为树编辑器中右键点击连线 → Disconnect，可以物理隔离分支
- **截图记录**：每次断开连线前截图，方便后续恢复
- **逐个测试**：完成一个测试用例后立即恢复配置，避免混淆
- **网络同步**：每个测试都要同时观察 Server 和 Client 窗口

**常见问题排查**：
- AI 不移动：检查 NavMesh、行为树启动状态、Check Game Phase Decorator
- AI 不响应红绿灯：检查 SM_Endurance、GS_Endurance.IsRedLight、BTService_UpdatePerception
- AI 不推搡/闪避：检查概率、Blackboard 键值、AbilitySet_Endurance
- 连线恢复错误：参考截图或 BT_Endurance.md 文档中的行为树结构

**参考文档**：
- `关卡设计/01-耐力之匣/AI/BT_Endurance.md` - AI 设计文档（包含完整行为树结构）
- `关卡设计/01-耐力之匣/AI/BT_Endurance_Components.md` - AI 组件文档

**关键依赖**：
- BT_Endurance（已创建）
- BTDecorator_CheckPhase（已创建）
- GM_Endurance.Level Behavior Tree = BT_Endurance（已配置）
- NavMeshBoundsVolume（已配置）


