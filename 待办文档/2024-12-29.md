# 2024-12-29 待办

## 当前阶段：关卡1 耐力之匣 设计完善

### 今日完成（设计）
- [x] AI 与玩家统一设计方案
- [x] 感知系统设计（DetectionBox）
- [x] 输入系统设计（IMC 分层）
- [x] 操作系统设计（组件化 + GM 配置驱动）
- [x] 确认 AIC 不需要子类
- [x] 更新相关设计文档
- [x] 投掷系统设计（MOTS 插件，瞄准→抛出两阶段）

### 待实现（关卡1 核心）- 按优先级排序

**P1 - 框架搭建**
- [x] GM_Endurance 配置（继承 GM_Core，配置关卡专属变量）
- [x] GS_Endurance 配置（继承 GS_Core，配置时长参数）

**P2 - 核心机制**
- [x] 红灯/绿灯状态切换（ST_Endurance 状态树）
- [x] GS_Endurance.IsRedLight 变量（RepNotify）
- [x] GS_Endurance.OnIsRedLightChange 事件分发器
- [x] GameplayTags 扩展（Player.Action.* / Player.State.*）
- [x] 玩家移动状态判定（Comp_Endurance 检测速度 → GE_Moving）

**P3 - 死亡判定**
- [x] BP_Puppet 木偶 Actor（骨骼网格 + 转身动画 + Anim Notify）
- [x] AN_DetectionStart（根据 bIsFacing 控制检测开关）
- [x] GS_Endurance.IsDetecting 变量（RepNotify）
- [x] GS_Endurance.Server_SetDetecting 函数
- [x] GS_Endurance.Multicast_PlayerDetected 函数
- [x] BP_Monitor 监视器 Actor（Line Trace 检测）
- [x] 红灯时检测 Player.State.Danger → 广播 OnPlayerDetected
- [ ] 对玩家造成伤害（HP 归零 → 淘汰）

**P4 - 场景与测试**
- [ ] 基础场景搭建（出生点、终点、木偶位置）

**P5 - 玩家交互**
- [ ] DetectionBox 组件（BP_Character_Game）
- [ ] Comp_Endurance 操作组件
- [ ] BT_Endurance 行为树
- [ ] AbilitySet_Endurance 技能集
- [ ] IMC_Endurance 输入映射

### 待实现（通用架构）
- [ ] 掉线 AI 接管逻辑
- [ ] 淘汰处理（IsEliminated 标记 + 实体销毁）
- [ ] 死亡后断开连接流程
- [ ] HP 跨关重置（每关开始时重置为 100，Coin 保留）
- [ ] 关卡结算阶段
- [ ] 无缝切换到下一关
