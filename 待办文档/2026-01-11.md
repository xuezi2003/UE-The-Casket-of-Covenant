# 2026-01-11 待办

## 当前阶段：关卡1 耐力之匣 - Phase 2 道具系统

> 设计文档：[总体策划](../关卡设计/01-耐力之匣/总体策划.md)、[道具系统](../关卡设计/01-耐力之匣/道具系统.md)

---

## 今日任务

### P1：功能验证

> [!IMPORTANT]
> 完成所有验证后，标记为 `[x]`。

#### 测试 1：双框检测 ✅

- [x] 进入 DetectionBox → 道具高亮
- [x] 离开 DetectionBox → 高亮消失
- [x] 两个 Client 互不影响（本地逻辑正确）

#### 测试 2：拾取 ✅

- [x] 触碰 InteractBox → 道具消失
- [x] Server/Client 1/Client 2 同步正确
- [x] `ThrowItemID` = Banana（调试确认）

#### 测试 3：瞄准 ✅

- [x] 按住右键 → 上半身举手动画
- [x] 手中出现 PropMesh（通过 Multicast RPC 同步）
- [x] 调试：ASC 存在 `Player.Action.Aiming`
- [x] 松开右键 → 退出瞄准，PropMesh 消失

> **Bug #1 已修复**：GE_Aiming 拆分为 GE_Aiming (Infinite) + GE_Aiming_Danger (0.25s)
> **Bug #2 已修复**：PropMesh 通过 Multicast_ShowPropInHand 同步

#### 测试 4：互斥（瞄准↔推搡）✅

- [x] 瞄准中点击左键 → 不触发推搡，触发 Throw

#### 测试 5：投掷 ✅

- [x] 瞄准中点击左键 → 播放投掷蒙太奇
- [x] 道具从手部 Spawn 并飞出（Flying 状态）
- [x] 投掷完成 → PropMesh 消失，退出瞄准
- [x] 调试：`ThrowItemID` 已清空

> **Bug #3 已修复**：BP_Item 添加 `InitialState` (E_ItemState)，GA_Throw 设为 Flying 避免立即触发拾取
> **Bug #4 已修复**：OnRep_ThrowItemID 添加 RowName 有效性检查
> **Bug #5 已修复**：PMC 设为自动注册更新组件，驱动根组件运动
> **Bug #6 已修复**：修正 PropMesh 的 HiddenInGame 和 Visibility 逻辑冲突
> **Bug #7 已修复**：GA_Throw.OnEndAbility 发送 `Gameplay.Event.Aim.End` 事件通知 GA_Aim 结束
> **架构改动**：Flying 状态从 `AddImpulse` 改为 `ProjectileMovementComponent` 驱动

#### 测试 6：多人同步 ✅

- [x] 拾取：Client 2 看到道具消失
- [x] 瞄准：Client 2 看到举手 + PropMesh
- [x] 投掷：Client 2 看到道具飞出

---

### P2：道具子类开发

| 子类 | 说明 | 状态 |
|------|------|:----:|
| BP_Item_Banana | 失衡 + 落地变陷阱 | ❌ |
| BP_Item_Bomb | 范围摔倒 | ❌ |
| BP_Item_Lightning | SpeedRate ×1.5 | ❌ |
| BP_Item_Shield | Shielded 标签 | ❌ |
| BP_Item_MedicalKit | HP +50 | ❌ |
| BP_Item_Coin | Coin +1 | ❌ |

### P3：护盾逻辑修改

- [ ] GA_Stagger / GA_Fall 检查 Shielded
- [ ] BP_Monitor 检测伤害减半

### P4：UI

- [ ] WBP_LevelHUD_Endurance
- [ ] 道具栏 / Buff 倒计时
