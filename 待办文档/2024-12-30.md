# 2024-12-30 待办

## 当前阶段：关卡1 耐力之匣 核心机制实现

### 今日完成
- [x] 修复 Comp_Endurance ASC 获取问题（通过 GSCCore 组件获取）
- [x] 修复 GS_Core MainST 未设置状态树资产问题
- [x] 修复组件复制问题（LevelCharacterComponentClass/LevelIMC 设为 Replicated）
- [x] 修复移动状态检测逻辑（分离 Apply/Remove 分支，添加 Has Authority 鉴权）
- [x] BP_Puppet 动画系统完善（Rotate Root Bone 方案，Turn/Turn_inv 状态机）
- [x] BP_Monitor 视线检测完善（PuppetVision 自定义 Trace Channel）
- [x] 玩家互相遮挡功能验证通过

### 待实现（关卡1 核心）

**P3 - 死亡判定**
- [ ] 对玩家造成伤害（HP 归零 → 淘汰）

**P4 - 场景与测试**
- [ ] 基础场景搭建（出生点、终点、木偶位置）

**P5 - 玩家交互**
- [ ] DetectionBox 组件（BP_Character_Game）
- [ ] BT_Endurance 行为树
- [ ] AbilitySet_Endurance 技能集
- [ ] IMC_Endurance 输入映射

### 待实现（通用架构）
- [ ] 掉线 AI 接管逻辑
- [ ] 淘汰处理（IsEliminated 标记 + 实体销毁）
- [ ] 死亡后断开连接流程
- [ ] HP 跨关重置（每关开始时重置为 100，Coin 保留）
- [ ] 关卡结算阶段
- [ ] 无缝切换到下一关

### 重要技术笔记

**ASC 获取（GSC 架构）**：
- ASC 挂在 PlayerState 上，不在 Character 上
- 必须通过 `GSCCore → Get Ability System Component from Actor` 获取
- 需要定时器轮询等待 ASC 初始化完成

**组件动态添加与复制**：
- GM 里动态添加的组件不会自动复制到客户端
- 解决方案：把组件类变量设为 Replicated，在 Character 的 InitPlayer 里添加

**Line Trace Ignore Self 陷阱**：
- Ignore Self 忽略的是调用 Line Trace 的 Actor
- 如果射线起点在其他 Actor 上，需要手动把该 Actor 加到 Actors to Ignore
