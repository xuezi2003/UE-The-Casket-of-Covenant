# 2026-01-03 待办

> [!IMPORTANT]
> **后期所有技能完成后，统一调整技能互斥关系**（Ability Blocked Tags / Cancel Tags）

## 当前阶段：关卡1 耐力之匣 - Phase 1 基础移动（收尾）

### 今日完成
- [x] 力竭机制重构
  - [x] 滞后阈值：0 进入 / 15 退出
  - [x] 使用 GSCCore 官方属性绑定（替代自定义 Async Task）
- [x] 跳跃体力消耗
  - [x] GA_Jump（监听 CMC 落地事件）
  - [x] GE_Jumping（Jumping 标签）
  - [x] GE_StaminaCost（通用 SetByCaller 消耗 -15）
  - [x] 激活阻止标签防止二段跳
- [x] GE_StaminaRegen 添加 Jumping 阻止条件

---

## 下一阶段：Phase 1 推搡/闪避系统

### 待办
- [ ] 推搡系统（GA_Push）
  - [ ] 推搡动作蒙太奇
  - [ ] 推搡效果：使目标进入失衡状态
  - [ ] GE_StaminaCost_Push（按次消耗 -15）
  - [ ] 玩家输入绑定（IA_Endurance_Push → IMC_Endurance）
  - [ ] BTTask_Push（AI 触发）
- [ ] 闪避系统（GA_Dodge）
  - [ ] 闪避动作蒙太奇
  - [ ] 闪避效果：短暂无敌帧
  - [ ] GE_StaminaCost_Dodge（按次消耗 -20）
  - [ ] 玩家输入绑定（IA_Endurance_Dodge → IMC_Endurance）
  - [ ] BTTask_Dodge（AI 触发）
- [ ] 失衡/摔倒状态
  - [ ] GA_Stagger（失衡状态）
  - [ ] GA_Fall（摔倒状态）
  - [ ] 玩家 QTE 恢复机制
  - [ ] AI 概率判定
- [ ] DetectionBox 组件（检测前方可交互对象）

---

## 开发计划总览

### Phase 0：测试环境搭建（✅ 完成）

### Phase 1：基础移动 + 玩家交互
- [x] 奔跑体力消耗（GE_StaminaDrain_Sprint）
- [x] 体力自动回复（GE_StaminaRegen）
- [x] 力竭机制（GE_Exhausted + GA_Exhausted）
- [x] 蹲行系统（GA_Crouch + GE_Crouch）
- [x] 速度属性同步修复（PostAttributeChange）
- [x] 蹲下/起身危险标签（Comp_Character_Endurance.HandleCrouching）
- [x] 跳跃体力消耗（GA_Jump + GE_StaminaCost）
- [ ] 推搡系统（GA_Push + BTTask_Push）
- [ ] 闪避系统（GA_Dodge + BTTask_Dodge）
- [ ] 失衡/摔倒状态（GA_Stagger + GA_Fall）
- [ ] DetectionBox 组件

### Phase 2：道具系统
- [ ] 投掷类（MOTS 插件）：香蕉皮、炸弹
- [ ] Buff 类（GE）：跑鞋、护盾、磁铁
- [ ] 资源类：金币

### Phase 3：完善
- [ ] 死亡判定（HP 归零 → 淘汰）
- [ ] 死亡广播（周围玩家失衡）
- [ ] AI 完善（体力管理、遮挡策略）

---

## 架构备忘

**职责分离**：
- Comp_Character_Endurance：检测逻辑（移动检测、Danger 标签）
- AbilitySet_Endurance：GAS 操作（推搡、闪避、投掷、失衡、摔倒、麻痹）
- GE 系列：状态效果
- IMC_Endurance：关卡1/5 专属输入
- BT_Endurance：AI 行为

**AI 设计原则**：
- 操作层统一，触发层分离
- 玩家和 AI 共用同一套 GAS Ability
- 失衡 QTE：玩家走 UI，AI 按概率判定

---

## 迁移自 2026-01-02

### 已完成任务（2026-01-02）
- ✅ SpeedRate 属性同步修复（双重保险方案）
- ✅ 文档审计：属性系统描述统一化
- ✅ 蹲下时 Mesh 位置错误修复（禁用网络平滑模式）
- ✅ 蹲下/起身危险标签（HandleCrouching）
