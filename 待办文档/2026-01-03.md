# 2026-01-03 待办

> [!IMPORTANT]
> **后期所有技能完成后，统一调整技能互斥关系**（Ability Blocked Tags / Cancel Tags）

## 当前阶段：关卡1 耐力之匣 - Phase 1 推搡系统（收尾）

### 今日完成
- [x] 力竭机制重构
  - [x] 滞后阈值：0 进入 / 15 退出
  - [x] 使用 GSCCore 官方属性绑定（替代自定义 Async Task）
- [x] 跳跃体力消耗
  - [x] GA_Jump（监听 CMC 落地事件）
  - [x] GE_Jumping（Jumping 标签）
  - [x] GE_StaminaCost（通用 SetByCaller 消耗 -15）
  - [x] 激活阻止标签防止二段跳
- [x] GE_StaminaRegen 添加 Jumping 阻止条件
- [x] **推搡系统（GA_Push）**
  - [x] IA_Endurance_Push 创建（鼠标左键）
  - [x] GE_Pushing 创建（Pushing + Danger 标签）
  - [x] GA_Push 基础框架（Check Stamina 宏 + Effect Container）
  - [x] Play Montage and Wait for Event 集成
  - [x] AN_GSC_SendGameplayEventByTag 动画通知
  - [x] DoSphereTrace 检测函数（TraceLen=120, TraceRadius=50）
  - [x] Send Gameplay Event to Actor（目标激活失衡）
- [x] 体力检查机制优化
  - [x] 一次性消耗技能不使用 `Ability.Require.Stamina` 标签
  - [x] 避免刚消耗就被力竭取消的问题
- [x] Gameplay Tags 更新
  - [x] `Gameplay.Event.Montage.Push`（蒙太奇通知）
  - [x] `Gameplay.Event.Activate.Stagger`（激活目标失衡）

---

## 下一阶段：失衡/闪避系统

### 待办
- [ ] **失衡系统（GA_Stagger）**
  - [ ] GA_Stagger 创建（通过 Gameplay Event 触发）
  - [ ] GE_Staggered 创建（Staggered 标签，**无 Danger**）
  - [ ] 失衡蒙太奇：向前踉跄两步（带根运动）
  - [ ] 失衡 Idle：原地摇晃（动画蓝图状态切换）
  - [ ] 暂不考虑 QTE 恢复和状态互斥
- [ ] 闪避系统（GA_Dodge）
  - [ ] 闪避动作蒙太奇
  - [ ] 闪避效果：短暂无敌帧（Invincible 标签）
  - [ ] GE_StaminaCost（按次消耗 -20）
  - [ ] 玩家输入绑定（IA_Endurance_Dodge）
- [ ] 摔倒状态（GA_Fall）
  - [ ] 失衡 QTE 失败 → 摔倒
  - [ ] 推人被闪避 → 摔倒
- [ ] AbilitySet_Endurance 添加新技能

---

## 开发计划总览

### Phase 0：测试环境搭建（✅ 完成）

### Phase 1：基础移动 + 玩家交互
- [x] 奔跑体力消耗（GE_StaminaDrain_Sprint）
- [x] 体力自动回复（GE_StaminaRegen）
- [x] 力竭机制（GE_Exhausted + GA_Exhausted）
- [x] 蹲行系统（GA_Crouch + GE_Crouch）
- [x] 速度属性同步修复（PostAttributeChange）
- [x] 蹲下/起身危险标签（Comp_Character_Endurance.HandleCrouching）
- [x] 跳跃体力消耗（GA_Jump + GE_StaminaCost）
- [x] 推搡系统（GA_Push + GE_Pushing + 检测逻辑）
- [ ] 失衡系统（GA_Stagger + GE_Staggered）
- [ ] 闪避系统（GA_Dodge + GE_Dodging）
- [ ] 摔倒状态（GA_Fall + GE_Fallen）
- [ ] DetectionBox 组件

### Phase 2：道具系统
- [ ] 投掷类（MOTS 插件）：香蕉皮、炸弹
- [ ] Buff 类（GE）：跑鞋、护盾、磁铁
- [ ] 资源类：金币

### Phase 3：完善
- [ ] 死亡判定（HP 归零 → 淘汰）
- [ ] 死亡广播（周围玩家失衡）
- [ ] AI 完善（体力管理、遮挡策略）
- [ ] BTTask_Push / BTTask_Dodge（AI 触发）

---

## 架构备忘

**职责分离**：
- Comp_Character_Endurance：检测逻辑（移动检测、Danger 标签）
- AbilitySet_Endurance：GAS 操作（推搡、闪避、投掷、失衡、摔倒、麻痹）
- GE 系列：状态效果
- IMC_Endurance：关卡1/5 专属输入
- BT_Endurance：AI 行为

**体力检查设计**：
- 持续消耗技能（GA_Sprint）→ 使用 `Ability.Require.Stamina` 标签
- 一次性消耗技能（GA_Push/Jump/Dodge）→ 不使用此标签，用 Check Stamina 宏

---

## 迁移自 2026-01-02

### 已完成任务（2026-01-02）
- ✅ SpeedRate 属性同步修复（双重保险方案）
- ✅ 文档审计：属性系统描述统一化
- ✅ 蹲下时 Mesh 位置错误修复（禁用网络平滑模式）
- ✅ 蹲下/起身危险标签（HandleCrouching）
